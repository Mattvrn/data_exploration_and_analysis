# Solar power generation data set

## Install packages

```{r}
library(tidyverse)
library(MASS)
library(caret)
library(ggplot2)
library(RColorBrewer)
library(corrplot)
library(klaR)
library(psych)
library(devtools)
library(patchwork)
library(zoo)
```


## Import data and setting graphic settings
```{r}
data = read.csv("sol_pow_gen.csv", sep = ",")

mycol = brewer.pal(5, "Set1")
  
data = na.omit(data)

#We put the date and time variables in one column only
day = as.Date(paste(data$Year, data$Month, data$Day), format = "%Y %m %d")
dates = as.POSIXct(paste(data$Year, data$Month, data$Day, paste0(data$First.Hour.of.Period, ":00:00")), format = "%Y %m %d %H", tz = "US/Pacific")
data = data[,-c(1, 2, 3, 4, 5)]
data = cbind(day, dates, data)

#Converting °F in °C
data$Average.Temperature..Day. = round((data$Average.Temperature..Day. - 32) * (5/9), 2)

colnames(data) = c("day", "dates", "daylight", "dist_sol_noon", "avg_temp", "avg_wind_dir", "avg_wind_speed", "sky_cov", "vis", "rel_humid", "avg_wind_speed_per", "avg_press", "pow_gen")

head(data)
```

## Data description

The data variables : 

Distance to Solar Noon : distance to the sun at noon (supposedly normalized around 1)

Average Temperature (Day) : the average temperature in the day (previously in °F, converted in °C)

Average Wind Direction (Day) : average direction of the wind // discrete "qualitative" variable with 36 modalities (36 directions possible)

Average Wind Speed (Day) : average wind speed (supposedly in km/h) // continuous quantitative

Sky Cover : sky coverage by clouds // qualitative variable with 5 modalities (0 is no coverage, 4 is a lot of coverage)

Relative Humidity : humidity of the day // quantitative variable, on a scale of 0 to 100%

Power Generated : power generated by the power plant in kW in the day // dependent variable, quantitative


At what time the data is being recorded ?
```{r}
cat(sprintf("The starting date of our data is at %s and it ends at %s\n", min(dates), max(dates)))
```

Proportion of daylight in the data along with the proportion of sky covering in the data
```{r}
#The pieplots
par(mfrow = c(1,2))
pie(table(data$daylight), border = "white", col = mycol, main = "Proportion of daylight \nin the data")
pie(table(data$sky_cov), border = "white", col = mycol, main = "Proportion of sky covering \nin the data")
pie(table(data$avg_wind_dir), border = "white", col = mycol, main = "Direction of wind\nin the data")
```

For the average temperature in the day
```{r}
#We regroup the avg temperature for each day as it is just repeated in the dataset (for the time period)
data_avg_temp = data %>%
  group_by(day) %>%
  summarize(avg_temp = mean(avg_temp))

ggplot(data = data_avg_temp, aes(x = day, y = avg_temp)) +
  geom_line(col = mycol[2]) +
  labs(title = "Average temperature per day",
       x = "Date",
       y = "Temperature (in °C)")
```

Let's take a look at the variable of interest : the generated power
```{r}
ggplot(data, aes(x = pow_gen)) + 
  geom_histogram(binwidth = 5000, color = "white", fill = mycol[2]) + 
  labs(title = "Histogram for the power generated", x = "Power generated", y = "Count over hour period")
```
We did most of the visualization in Python, so let's dive in the data analysis for now

## Data analysis

Based on our findings in Python, we saw that the distance to solar noon mean was a lot lower when there was power generated than when there was not. Let's investigate this
```{r}
#The data of interest
dist_sol_no_pow = data[data$pow_gen==0,]$dist_sol_noon
dist_sol_pow = data[data$pow_gen!=0,]$dist_sol_noon

sprintf("The distance to solar noon mean for the subgroup of 0 power generated is of %s", round(mean(dist_sol_no_pow), 3))
sprintf("The distance to solar noon mean for the subgroup of above 0 power generated is of %s", round(mean(dist_sol_pow), 3))
```

Let's perform a t-test
IV : Power generated, qualitative, 2 modalities : 0 or >0
DV : Distance to solar noon, quantitative, continuous

H0 : there is no difference between the mean of the distance for no generated power and the distance for >0 generated power
H1 : there is a difference 
```{r}
#Let's check assumptions first ; is the data normally distributed
shapiro.test(dist_sol_no_pow)
shapiro.test(dist_sol_pow)

qqnorm(dist_sol_no_pow) #It is not normally distributed at all (p-value well below 0.001, qqplot not following the diagonal)
#We can still go about the test, but we know that we cannot take the result into account
```
```{r}
#The t-test
t.test(dist_sol_no_pow, dist_sol_pow, alternative = c("greater"), conf.level = 0.95) #of course we get a very small p-value. If the test was valid, we could reject H0 and accept H1
```

Using our results in Python, we also know distance to solar and power generated are negatively correlated
```{r}
#The correlation coefficient between the 2 variables
cor(data$dist_sol_noon, data$pow_gen)
```

Let's see if the linear regression has interesting coefficients
```{r}
#The linear regression
data_ord_dist = data[order(data$dist_sol_noon),]

ggplot(data = data, aes(x = dist_sol_noon, y = pow_gen)) +
  geom_line(aes(color = "Observed values")) + 
  geom_smooth(method = "lm", aes(color = "Regression line"), se = FALSE) +
  scale_color_manual(values = c("Observed values" = mycol[3], "Regression line" = mycol[1])) +
  labs(title = "Linear regression between the distance to solar noon\nand the power generated",
       x = "Distance to solar noon", 
       y = "Power generated",
       color = "Legend") +  
  theme_minimal()


linear_model = lm(data_ord_dist$dist_sol_noon~data_ord_dist$pow_gen)
summary(linear_model) #We observe an R2 of 0.5576, which is not that good
```











